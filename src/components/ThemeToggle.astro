---
---

<button
  id="theme-toggle"
  class="fixed top-4 right-4 p-2 opacity-60 hover:opacity-100 transition-opacity z-50"
  title="Toggle theme"
>
  <span id="theme-icon-light" class="i-mdi-weather-sunny w-6 h-6 block text-primary hidden" />
  <span id="theme-icon-dark" class="i-mdi-weather-night w-6 h-6 block text-primary hidden" />
</button>

<script>
  function setupThemeToggle() {
    const toggle = document.getElementById('theme-toggle')
    const iconLight = document.getElementById('theme-icon-light')
    const iconDark = document.getElementById('theme-icon-dark')

    function updateIcon() {
      const isDark = document.documentElement.classList.contains('dark')
      if (iconLight && iconDark) {
        iconLight.classList.toggle('hidden', isDark)
        iconDark.classList.toggle('hidden', !isDark)
      }
    }

    function toggleTheme() {
      const isDark = document.documentElement.classList.contains('dark')
      document.documentElement.classList.toggle('dark', !isDark)
      localStorage.setItem('theme', isDark ? 'light' : 'dark')
      updateIcon()
    }

    // Initial icon update
    updateIcon()

    // Add click listener
    toggle?.addEventListener('click', toggleTheme)

    // Watch for class changes
    const observer = new MutationObserver(updateIcon)
    observer.observe(document.documentElement, { attributes: true, attributeFilter: ['class'] })
  }

  // Run on initial load
  setupThemeToggle()

  // Run after Swup page transitions
  document.addEventListener('swup:contentReplaced', setupThemeToggle)
</script>
