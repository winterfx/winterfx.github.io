---
import LayoutDefault from '~/layouts/LayoutDefault.astro'
import { getCollection } from 'astro:content'

const thoughts = (await getCollection('thoughts')).sort(
  (a, b) => b.data.date.valueOf() - a.data.date.valueOf()
)

function formatDate(date: Date) {
  return date.toLocaleDateString('en-US', {
    month: 'short',
    day: 'numeric',
    year: 'numeric',
  })
}
---

<LayoutDefault>
  <div class="max-w-3xl mx-auto px-4 sm:px-6 lg:px-8 py-10">
    <header class="mb-12">
      <h1 class="text-3xl font-bold mb-4">Thoughts</h1>
      <p class="text-lg opacity-60">
        碎片想法、日志与未成形的观点。A stream of consciousness.
      </p>
    </header>

    <div class="relative border-l border-primary/20 ml-3 md:ml-6 space-y-12">
      {
        thoughts.map(async (thought) => {
          const { Content } = await thought.render()
          return (
            <div class="relative pl-8 md:pl-12 group">
              {/* Dot on timeline */}
              <span class="absolute -left-[5px] top-1 h-2.5 w-2.5 rounded-full bg-primary/40 ring-4 ring-bg-body group-hover:bg-primary transition-colors duration-300" />
              
              {/* Date */}
              <time class="block text-sm font-mono opacity-50 mb-2">
                {formatDate(thought.data.date)}
              </time>

              {/* Content Card */}
              <div class="prose prose-truegray max-w-none 
                prose-p:my-2 prose-ul:my-2 prose-li:my-0
                hover:prose-a:text-primary transition-colors">
                <Content />
              </div>

              {/* Tags */}
              {thought.data.tags && (
                <div class="mt-3 flex gap-2">
                  {thought.data.tags.map((tag) => (
                    <span class="text-xs px-2 py-0.5 rounded-full bg-primary/5 text-primary/70">
                      #{tag}
                    </span>
                  ))}
                </div>
              )}
            </div>
          )
        })
      }
    </div>

    {thoughts.length === 0 && (
      <div class="py-12 text-center opacity-40">
        <p>还没有记录任何想法...</p>
      </div>
    )}
  </div>
</LayoutDefault>
